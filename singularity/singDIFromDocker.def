Bootstrap: docker
From: tensorflow/tensorflow:2.2.2-gpu
Stage: spython-base

%post

REPO_TAG="master"
COMMIT="unspecified to docker build"

adduser deepuser

REPOS=/home/deepuser/repos
REPO=/home/deepuser/repos/deepinterpolation
CONDA_ENVS_PATH=/home/deepuser/envs
CONDA_PKGS_DIRS=/home/deepuser/pkgs
CONDA_ENV_NAME=deep_env
DEEPINTERPOLATION_COMMIT_SHA=${COMMIT}
TMPDIR=/tmp

apt-get update \
&& apt-get -y install git python3-pip

mkdir ${REPOS} \
&& git clone -b ${REPO_TAG} https://github.com/nguyemi5/caDIProcessing ${REPO} \
&& pip install ${REPO}

%environment
export REPOS=/home/deepuser/repos
export REPO=/home/deepuser/repos/deepinterpolation
export CONDA_ENVS_PATH=/home/deepuser/envs
export CONDA_PKGS_DIRS=/home/deepuser/pkgs
export CONDA_ENV_NAME=deep_env
export DEEPINTERPOLATION_COMMIT_SHA=${COMMIT}
export TMPDIR=/tmp

%runscript
exec /bin/bash -c $@ --

%startscript
exec /bin/bash -c $@ --